<div class="cart-header">
  <h1>Your Cart</h1>
  <% if @cart.cart_items.empty? %>
    <div class="empty-cart">
      <p>Your cart is empty.</p>
      <%= link_to "Continue Shopping", products_path, class: "btn btn-primary" %>
    </div>
    <% return %>
  <% end %>
</div>

<div class="cart-items">
  <% @cart.cart_items.each do |item| %>
    <% next unless item.variant.present? || item.product.present? %>
    <% product = item.variant&.product || item.product %>
    <% next unless product.present? %>
    <div class="cart-item">
      <div class="item-image">
        <% if product.primary_image.present? %>
          <%= image_tag product.primary_image.variant(resize_to_limit: [100, 100]), alt: item.product_name, class: "product-image" %>
        <% else %>
          <div class="no-image">No Image</div>
        <% end %>
      </div>
      
      <div class="item-details">
        <h3><%= item.product_name %></h3>
        
        <% if item.variant.present? %>
          <p class="variant-info"><%= item.variant.size.humanize %> / <%= item.variant.grind.humanize %></p>
          <p class="sku">SKU: <%= item.variant.sku || "N/A" %></p>
          <% if item.variant.out_of_stock? %>
            <p class="stock-warning out-of-stock">⚠ Out of Stock</p>
          <% elsif item.variant.low_stock? %>
            <p class="stock-warning low-stock">⚠ Low Stock - Only <%= item.variant.inventory_quantity %> left</p>
          <% end %>
        <% else %>
          <p class="sku">SKU: <%= product.sku || "N/A" %></p>
        <% end %>
      </div>
      
      <div class="item-price">
        <p class="price">₹<%= number_with_precision(item.price, precision: 2) %></p>
        <p class="subtotal">₹<%= number_with_precision(item.price * item.quantity, precision: 2) %></p>
      </div>
      
      <div class="item-quantity">
        <%= form_with(url: cart_item_path(item), method: :patch, local: true, class: "quantity-form") do |form| %>
          <%= form.number_field :quantity, value: item.quantity, min: 1, max: 99, class: "quantity-input" %>
          <%= form.submit "Update", class: "btn btn-sm btn-secondary" %>
        <% end %>
      </div>
      
      <div class="item-actions">
        <%= button_to "Remove", cart_item_path(item), method: :delete, 
            class: "btn btn-sm btn-danger", 
            data: { confirm: "Are you sure you want to remove this item?" } %>
      </div>
    </div>
  <% end %>
</div>

<div class="cart-summary">
  <div class="cart-total">
    <h3>Order Total</h3>
    <p class="total-amount">₹<%= number_with_precision(@cart.total, precision: 2) %></p>
  </div>
  <div class="cart-actions">
    <%= link_to "Continue Shopping", products_path, class: "btn btn-secondary" %>
    <%= link_to "Proceed to Checkout", "#", class: "btn btn-primary" %>
  </div>
</div>
